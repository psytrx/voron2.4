[gcode_macro PARK]
gcode:
    SAVE_GCODE_STATE NAME=PARK

    {% set z_safe = printer.toolhead.position.z + 50 %}
    {% set max_z = printer.toolhead.axis_maximum.z - printer.gcode_move.homing_origin.z %}
    {% if z_safe > max_z %}
        {% set z_safe = max_z %}
    {% endif %}

    G90 ; absolute positioning
    G0 Z{z_safe}
    G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2}

    RESTORE_GCODE_STATE NAME=PARK
